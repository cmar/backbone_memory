  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.js"></script>
  <script src="javascripts/underscore-min.js"></script>
  <script src="javascripts/backbone-min.js"></script>

  <script src="javascripts/models/card.js"></script>
  <script src="javascripts/models/deck.js"></script>

  <script type="text/template" id="card_template">
    <img src="http://www.customink.com/clipart/manipulate?clipart_id=<%= clipart_id %>&width=100&height=100&red=0&green=0&blue=0">
  </script>

  <style type="text/css">
    .container {
      margin: 20px auto 60px;
      width: 840px;
    }

    #board {
      margin: 20px auto 60px;
      width: 840px;
    }

    .card {
      float: left;
      height: 100px;
      width: 100px;
      margin: 5px;
      padding: 10px;
      background: gray;
    }

    .card img {
      visibility: visible;
    }

    .selected {
      background: green;
    }

    .selected img {
      visibility: visible;
    }

    .matched {
      background: red;
    }

    .matched img {
      visibility: visible;
    }
  </style>

  <script type="text/javascript">
    var CARDS = [
      { name: "bear", clipart_id: "49609" },
      { name: "wolf", clipart_id: "133783" },
      { name: "headphones", clipart_id: "148990" },
      { name: "anchor", clipart_id: "126060" },
      { name: "monkey", clipart_id: "117963" },
      { name: "guns", clipart_id: "118253" },
      { name: "viking", clipart_id: "133773" },
      { name: "robot", clipart_id: "145644" },
      { name: "mustache", clipart_id: "117909" },
      { name: "boombox", clipart_id: "127681" },
      { name: "skull", clipart_id: "116712" },
      { name: "chef", clipart_id: "126708" }
    ]
  </script>

<script>
  $(function() {
    var CardView = Backbone.View.extend({
      tagName: "div",
      className: "card",
      template: _.template($("#card_template").html()),

      events: {
        "click": "select"
      },

      initialize: function() {
        this.model.on("change:selected", this.updateStyles, this)
      },

      render: function() {
        $(this.el).html(this.template(this.model.attributes))
        this.updateStyles()
        return this
      },

      updateStyles: function() {
        $(this.el).removeClass("selected matched")

        if (this.model.isMatched()) {
          $(this.el).addClass("matched")
        } else if (this.model.isSelected()) {
          $(this.el).addClass("selected")
        }
      },

      select: function(element) {
        this.model.select()
      }
    })

    var GameBoard = Backbone.View.extend({
      el: $("#board"),

      initialize: function() {
      },

      render: function() {
        this.collection.each(function(card) {
          var cardView = new CardView({ model: card })
          $(this.el).append(cardView.render().el)
        }, this)

        return this
      }
    })

    var ScoreBoard = Backbone.View.extend({
      el: $("#scoreboard"),

      initialize: function() {
        this.totalSelected = 0
        this.totalMatched = 0

        this.collection.on("change:selected", this.incrementSelected, this)
        this.collection.on("change:matched", this.incrementMatched, this)
        this.collection.on("all:matched", this.winner, this)
      },

      incrementSelected: function(model, value) {
        if (value) {
         this.totalSelected++
         this.$(".click-score").html(this.totalSelected)
       }
      },

      incrementMatched: function(model, value) {
        if (value) {
         this.totalMatched += .5
         this.$(".match-score").html(this.totalMatched)
       }
      },

      winner: function() {
        $('#you-win').show()
      },

      render: function() {
        // $(this.el).html("score!")
      }
    })

    //-- start
    var cards = _.shuffle(CARDS.slice().concat(CARDS))
    var deck = new Deck(cards)

    var gameBoard = new GameBoard({ collection: deck })
    gameBoard.render()

    var scoreBoard = new ScoreBoard({ collection: deck })
    scoreBoard.render()

    // $(document).on("keydown", function(event) {
    //   if (event.keyCode == 67) {
    //     this.cheat()
    //   }
    // }, deck)
  })
</script>

<body>
  <h1>Memory Game</h1>
  <h1 id="you-win" style='display: none;'>You Win</h1>

  <div id='scoreboard'>
    <h2>Clicks <span class="click-score">0</span></h2>
    <h2>Matched <span class="match-score">0</span>/12</h2>
  </div>

  <div id='board'></div>
</body>
